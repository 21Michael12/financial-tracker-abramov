<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×™×•××Ÿ ××¡×—×¨</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ×¨×§×¢ ×’×œ×•×‘×œ×™ - ××•×¤×™×¢ ××™×“ ×›×©× ×›× ×¡×™× ×œ××ª×¨! */
    html, body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      background-attachment: fixed;
      overflow-x: hidden;
    }
    * { scroll-behavior: smooth; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: rgba(17, 24, 39, 0.5); }
    ::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.5); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(6, 182, 212, 0.7); }
    
    /* Loading Screen Animations */
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
    
    @keyframes fadeIn {
      0% {
        opacity: 0;
        transform: scale(0.95);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes fadeInScale {
      0% {
        opacity: 0;
        transform: scale(0.9);
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(6, 182, 212, 0.1);
      border-top: 4px solid #06b6d4;
      border-right: 4px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    #loading-screen {
      animation: fadeInScale 0.5s ease-out;
    }
    
    /* Ensure #root has background to prevent white flash */
    #root {
      min-height: 100vh;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    
    .loading-dots::after {
      content: '...';
      animation: dots 1.5s steps(3) infinite;
    }
    
    .loading-title {
      font-size: 36px;
      font-weight: 900;
      background: linear-gradient(90deg, #06b6d4, #3b82f6, #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      animation: pulse 2s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <!-- Loading Screen Overlay - Beautiful loading with gradient background -->
  <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); color: white; z-index: 9999;">
    <div style="text-align: center;">
      <!-- Spinner Animation -->
      <div style="margin-bottom: 30px;">
        <div class="spinner"></div>
      </div>
      
      <!-- Loading Title -->
      <div class="loading-title">×™×•××Ÿ ××¡×—×¨</div>
      
      <!-- Loading Text -->
      <div style="font-size: 16px; color: #94a3b8; opacity: 0.9; margin-top: 8px;">
        ×‘×•×“×§ ×”×ª×—×‘×¨×•×ª<span class="loading-dots"></span>
      </div>
      
      <!-- Icon -->
      <div style="margin-top: 20px; opacity: 0.3;">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="20" x2="18" y2="10"></line>
          <line x1="12" y1="20" x2="12" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="14"></line>
        </svg>
      </div>
    </div>
  </div>
  
  <!-- React App Container -->
  <div id="root"></div>
  
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, getDocs, setDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCXzQmNV_lIj-3aRXaLUIqKESgR0_-V6ZQ",
      authDomain: "tradingjournal-abramov.firebaseapp.com",
      projectId: "tradingjournal-abramov",
      storageBucket: "tradingjournal-abramov.firebasestorage.app",
      messagingSenderId: "837839306524",
      appId: "1:837839306524:web:dfed02b3a02573e3f444d9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    
    // Firebase Auth automatically persists the user session in localStorage
    // Users will stay logged in even after closing the browser
    // To sign out, they must explicitly click the logout button

    console.log('ğŸ”¥ Firebase initialized');

    // Export Firebase for global use
    window.firebaseApp = app;
    window.firebaseDB = db;
    window.firebaseAuth = auth;
    window.firebaseModules = { 
      collection, getDocs, setDoc, deleteDoc, doc,
      createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged
    };
    
    // Dispatch event to let React know Firebase is ready
    window.dispatchEvent(new CustomEvent('firebaseModulesReady'));
    console.log('âœ… Firebase modules ready');
  </script>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  
  <script type="text/babel">
    console.log('ğŸš€ Starting app...');
    console.log('React:', typeof React !== 'undefined' ? 'âœ…' : 'âŒ');
    console.log('ReactDOM:', typeof ReactDOM !== 'undefined' ? 'âœ…' : 'âŒ');
    console.log('Babel:', typeof Babel !== 'undefined' ? 'âœ…' : 'âŒ');
    
    // Check Firebase
    setTimeout(() => {
      console.log('Firebase modules:', window.firebaseModules ? 'âœ…' : 'âŒ');
      console.log('Firebase auth:', window.firebaseAuth ? 'âœ…' : 'âŒ');
      console.log('Firebase DB:', window.firebaseDB ? 'âœ…' : 'âŒ');
    }, 100);

    // Fallback: Remove loading screen after 10 seconds if app doesn't load
    setTimeout(() => {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen && loadingScreen.parentNode) {
        console.warn('âš ï¸ Loading screen timeout - force removing');
        loadingScreen.remove();
      }
    }, 10000);

    const { useState, useEffect, useRef } = React;

    // Simple SVG Icons
    const Icon = ({ children, size = 24, ...props }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}>
        {children}
      </svg>
    );

    const CalendarIcon = (props) => <Icon {...props}><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></Icon>;
    const PlusIcon = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></Icon>;
    const EditIcon = (props) => <Icon {...props}><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></Icon>;
    const TrashIcon = (props) => <Icon {...props}><path d="M3 6h18M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></Icon>;
    const DollarIcon = (props) => <Icon {...props}><line x1="12" y1="2" x2="12" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></Icon>;
    const ChartIcon = (props) => <Icon {...props}><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></Icon>;
    const SettingsIcon = (props) => <Icon {...props}><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"/></Icon>;
    const UserIcon = (props) => <Icon {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>;
    const LockIcon = (props) => <Icon {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Icon>;
    const EyeIcon = (props) => <Icon {...props}><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></Icon>;
    const EyeOffIcon = (props) => <Icon {...props}><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></Icon>;
    const LogOutIcon = (props) => <Icon {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></Icon>;
    const CheckIcon = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"/></Icon>;

    // Authentication Screen Component
    const AuthScreen = () => {
      console.log('ğŸ” AuthScreen rendering...');
      
      const [isLogin, setIsLogin] = useState(true);
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [showPassword, setShowPassword] = useState(false);
      const [showConfirmPassword, setShowConfirmPassword] = useState(false);
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);

      // Password validation rules
      const validatePassword = (pass) => {
        return {
          minLength: pass.length >= 6,
          maxLength: pass.length <= 20,
          hasUppercase: /[A-Z]/.test(pass),
          isEnglish: /^[A-Za-z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/.test(pass)
        };
      };

      const passwordRules = validatePassword(password);
      const isPasswordValid = !isLogin ? (
        passwordRules.minLength && 
        passwordRules.maxLength && 
        passwordRules.hasUppercase && 
        passwordRules.isEnglish
      ) : true;

      useEffect(() => {
        console.log('âœ… AuthScreen mounted!');
      }, []);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);

        if (!email || !password) {
          setError('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª');
          setLoading(false);
          return;
        }

        // Validation for signup only
        if (!isLogin) {
          if (password.length < 6) {
            setError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×');
            setLoading(false);
            return;
          }

          if (password.length > 20) {
            setError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ××§×¡×™××•× 20 ×ª×•×•×™×');
            setLoading(false);
            return;
          }

          if (!/[A-Z]/.test(password)) {
            setError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª ××•×ª ×’×“×•×œ×” ××—×ª ×‘×× ×’×œ×™×ª');
            setLoading(false);
            return;
          }

          if (!/^[A-Za-z0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]*$/.test(password)) {
            setError('×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×¨×§ ×ª×•×•×™× ×‘×× ×’×œ×™×ª');
            setLoading(false);
            return;
          }

          if (password !== confirmPassword) {
            setError('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
            setLoading(false);
            return;
          }
        }

        try {
          const auth = window.firebaseAuth;
          const { createUserWithEmailAndPassword, signInWithEmailAndPassword } = window.firebaseModules;

          if (isLogin) {
            await signInWithEmailAndPassword(auth, email, password);
            console.log('âœ… Logged in successfully');
          } else {
            await createUserWithEmailAndPassword(auth, email, password);
            console.log('âœ… Account created successfully');
          }
        } catch (err) {
          console.error('âŒ Auth error:', err);
          
          if (err.code === 'auth/email-already-in-use') {
            setError('×”××™×™×œ ×›×‘×¨ ×§×™×™× ×‘××¢×¨×›×ª');
          } else if (err.code === 'auth/invalid-email') {
            setError('×›×ª×•×‘×ª ××™×™×œ ×œ× ×ª×§×™× ×”');
          } else if (err.code === 'auth/user-not-found') {
            setError('××©×ª××© ×œ× × ××¦×');
          } else if (err.code === 'auth/wrong-password' || err.code === 'auth/invalid-credential') {
            setError('×¡×™×¡××” ×©×’×•×™×”');
          } else if (err.code === 'auth/weak-password') {
            setError('×”×¡×™×¡××” ×—×œ×©×” ××“×™');
          } else {
            setError('×©×’×™××”: ' + (err.message || '× ×¡×” ×©×•×‘'));
          }
        } finally {
          setLoading(false);
        }
      };

      return (
        <div className="min-h-screen flex items-center justify-center p-4" style={{ background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)' }}>
          <div className="auth-container w-full max-w-md" style={{ animation: 'fadeIn 0.5s ease-out' }}>
            <div className="text-center mb-8">
              <div className="flex items-center justify-center mb-4">
                <ChartIcon size={48} className="text-cyan-400" />
              </div>
              <h1 className="text-5xl font-black mb-3 bg-gradient-to-r from-cyan-400 via-blue-500 to-purple-600 bg-clip-text text-transparent">
                ×™×•××Ÿ ××¡×—×¨
              </h1>
              <p className="text-gray-400 text-sm">×™×•××Ÿ ×”××¡×—×¨ ×©×™×¢×–×•×¨ ×œ×š ×œ×”×™×•×ª ×¡×•×—×¨ ×˜×•×‘ ×™×•×ª×¨</p>
            </div>

            <div className="bg-gray-900/90 backdrop-blur-xl rounded-2xl border border-cyan-500/30 p-8 shadow-2xl">
              <div className="flex gap-2 mb-6 bg-gray-800/50 p-1 rounded-xl">
                <button
                  onClick={() => { setIsLogin(true); setError(''); }}
                  className={`flex-1 py-3 rounded-lg font-semibold transition-all ${
                    isLogin 
                      ? 'bg-cyan-500 text-white shadow-lg' 
                      : 'text-gray-400 hover:text-gray-200'
                  }`}
                >
                  ×”×ª×—×‘×¨×•×ª
                </button>
                <button
                  onClick={() => { setIsLogin(false); setError(''); }}
                  className={`flex-1 py-3 rounded-lg font-semibold transition-all ${
                    !isLogin 
                      ? 'bg-cyan-500 text-white shadow-lg' 
                      : 'text-gray-400 hover:text-gray-200'
                  }`}
                >
                  ×”×¨×©××”
                </button>
              </div>

              <form onSubmit={handleSubmit} className="space-y-5">
                <div>
                  <label className="block text-sm text-gray-300 mb-2 font-medium">
                    <UserIcon size={16} className="inline ml-2" />
                    ×›×ª×•×‘×ª ××™×™×œ
                  </label>
                  <input
                    type="email"
                    value={email}
                    onChange={(e) => setEmail(e.target.value)}
                    className="w-full px-4 py-3 bg-gray-800/50 border border-cyan-500/30 rounded-xl text-gray-200 placeholder-gray-500 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 transition-all"
                    placeholder="your@email.com"
                    disabled={loading}
                    autoComplete="email"
                  />
                </div>

                <div>
                  <div className="flex items-center justify-between mb-2">
                    <label className="text-sm text-gray-300 font-medium">
                      <LockIcon size={16} className="inline ml-2" />
                      ×¡×™×¡××”
                    </label>
                    {!isLogin && (
                      <span className="text-xs text-gray-500">×œ×—×¥ ×¢×œ ×”×¢×™×Ÿ ğŸ‘ï¸ ×œ×¨××•×ª ×”×¡×™×¡××”</span>
                    )}
                  </div>
                  <div className="relative">
                    <input
                      type={showPassword ? "text" : "password"}
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="w-full px-4 py-3 pl-12 bg-gray-800/50 border border-cyan-500/30 rounded-xl text-gray-200 placeholder-gray-500 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 transition-all"
                      placeholder={showPassword ? "MyPassword123" : "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}
                      disabled={loading}
                      autoComplete={isLogin ? "current-password" : "new-password"}
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute left-3 top-1/2 -translate-y-1/2 p-2 text-gray-400 hover:text-cyan-400 transition-colors rounded-lg hover:bg-gray-700/30"
                      tabIndex={-1}
                      title={showPassword ? "×”×¡×ª×¨ ×¡×™×¡××”" : "×”×¦×’ ×¡×™×¡××”"}
                    >
                      {showPassword ? <EyeOffIcon size={20} /> : <EyeIcon size={20} />}
                    </button>
                  </div>
                  {!isLogin && password.length > 0 && (
                    <div className="mt-3 p-3 bg-gray-800/30 rounded-lg border border-gray-700/50 transition-all duration-300">
                      <p className="text-xs text-gray-400 font-semibold mb-2">×“×¨×™×©×•×ª ×¡×™×¡××”:</p>
                      <div className="space-y-1.5">
                        <div className={`flex items-center gap-2 text-xs transition-colors duration-200 ${passwordRules.minLength ? 'text-emerald-400' : 'text-gray-500'}`}>
                          <span className="font-bold">{passwordRules.minLength ? 'âœ“' : 'â—‹'}</span>
                          <span>×œ×¤×—×•×ª 6 ×ª×•×•×™×</span>
                        </div>
                        <div className={`flex items-center gap-2 text-xs transition-colors duration-200 ${passwordRules.maxLength ? 'text-emerald-400' : 'text-gray-500'}`}>
                          <span className="font-bold">{passwordRules.maxLength ? 'âœ“' : 'â—‹'}</span>
                          <span>××§×¡×™××•× 20 ×ª×•×•×™×</span>
                        </div>
                        <div className={`flex items-center gap-2 text-xs transition-colors duration-200 ${passwordRules.hasUppercase ? 'text-emerald-400' : 'text-gray-500'}`}>
                          <span className="font-bold">{passwordRules.hasUppercase ? 'âœ“' : 'â—‹'}</span>
                          <span>×œ×¤×—×•×ª ××•×ª ×’×“×•×œ×” ××—×ª ×‘×× ×’×œ×™×ª (A-Z)</span>
                        </div>
                        <div className={`flex items-center gap-2 text-xs transition-colors duration-200 ${passwordRules.isEnglish ? 'text-emerald-400' : 'text-gray-500'}`}>
                          <span className="font-bold">{passwordRules.isEnglish ? 'âœ“' : 'â—‹'}</span>
                          <span>×¨×§ ×ª×•×•×™× ×‘×× ×’×œ×™×ª (××•×ª×™×•×ª, ××¡×¤×¨×™× ×•×¡×™×× ×™×)</span>
                        </div>
                      </div>
                      {isPasswordValid && (
                        <div className="mt-2 pt-2 border-t border-emerald-500/30 animate-pulse">
                          <div className="flex items-center gap-2 text-xs text-emerald-400 font-semibold">
                            <span>âœ“</span>
                            <span>×”×¡×™×¡××” ×¢×•××“×ª ×‘×›×œ ×”×“×¨×™×©×•×ª!</span>
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {!isLogin && (
                  <div>
                    <label className="block text-sm text-gray-300 mb-2 font-medium">
                      <LockIcon size={16} className="inline ml-2" />
                      ××™××•×ª ×¡×™×¡××”
                    </label>
                    <div className="relative">
                      <input
                        type={showConfirmPassword ? "text" : "password"}
                        value={confirmPassword}
                        onChange={(e) => setConfirmPassword(e.target.value)}
                        className="w-full px-4 py-3 pl-12 bg-gray-800/50 border border-cyan-500/30 rounded-xl text-gray-200 placeholder-gray-500 focus:border-cyan-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 transition-all"
                        placeholder={showConfirmPassword ? "MyPassword123" : "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"}
                        disabled={loading}
                        autoComplete="new-password"
                      />
                      <button
                        type="button"
                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                        className="absolute left-3 top-1/2 -translate-y-1/2 p-2 text-gray-400 hover:text-cyan-400 transition-colors rounded-lg hover:bg-gray-700/30"
                        tabIndex={-1}
                        title={showConfirmPassword ? "×”×¡×ª×¨ ×¡×™×¡××”" : "×”×¦×’ ×¡×™×¡××”"}
                      >
                        {showConfirmPassword ? <EyeOffIcon size={20} /> : <EyeIcon size={20} />}
                      </button>
                    </div>
                    <p className="text-xs text-gray-500 mt-2">×”×–×Ÿ ××ª ××•×ª×” ×¡×™×¡××” ×©×•×‘</p>
                  </div>
                )}

                {error && (
                  <div className="bg-red-500/10 border border-red-500/30 rounded-xl p-4 text-red-400 text-sm text-center animate-pulse">
                    âš ï¸ {error}
                  </div>
                )}

                <button
                  type="submit"
                  disabled={loading || (!isLogin && !isPasswordValid)}
                  className="w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:from-cyan-600 hover:to-blue-700 transition-all shadow-lg hover:shadow-cyan-500/50 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 mt-6"
                >
                  {loading ? (
                    <>
                      <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                      <span>×˜×•×¢×Ÿ...</span>
                    </>
                  ) : (
                    <>
                      {isLogin ? <LogOutIcon size={20} className="rotate-180" /> : <UserIcon size={20} />}
                      <span>{isLogin ? '×”×ª×—×‘×¨ ×œ×—×©×‘×•×Ÿ' : '×¦×•×¨ ×—×©×‘×•×Ÿ ×—×“×©'}</span>
                    </>
                  )}
                </button>
                
                {!isLogin && !isPasswordValid && password.length > 0 && (
                  <div className="mt-2 text-center">
                    <p className="text-xs text-yellow-400 flex items-center justify-center gap-2">
                      <span>âš ï¸</span>
                      <span>×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×¢××•×“ ×‘×›×œ ×”×“×¨×™×©×•×ª ×›×“×™ ×œ×”×™×¨×©×</span>
                    </p>
                  </div>
                )}
              </form>

              <div className="mt-6 text-center text-sm text-gray-400">
                {isLogin ? (
                  <p>
                    ××™×Ÿ ×œ×š ×—×©×‘×•×Ÿ?{' '}
                    <button onClick={() => { setIsLogin(false); setError(''); setPassword(''); setEmail(''); }} className="text-cyan-400 hover:text-cyan-300 font-semibold underline">
                      ×”×™×¨×©× ×¢×›×©×™×•
                    </button>
                  </p>
                ) : (
                  <p>
                    ×›×‘×¨ ×™×© ×œ×š ×—×©×‘×•×Ÿ?{' '}
                    <button onClick={() => { setIsLogin(true); setError(''); setPassword(''); setConfirmPassword(''); }} className="text-cyan-400 hover:text-cyan-300 font-semibold underline">
                      ×”×ª×—×‘×¨
                    </button>
                  </p>
                )}
              </div>
            </div>

            <div className="text-center mt-8 text-xs text-gray-500">
              <p className="flex items-center justify-center gap-2 mb-2">
                <LockIcon size={14} />
                ×××•×‘×˜×— ×¢× Firebase Authentication
              </p>
              <p className="text-xs text-gray-600">
                ğŸ’¡ ×ª×™×©××¨ ××—×•×‘×¨ ×’× ×œ××—×¨ ×¡×’×™×¨×ª ×”×“×¤×“×¤×Ÿ
              </p>
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      console.log('ğŸ“± App component rendering...');
      
      const [userId, setUserId] = useState(null);
      const [userEmail, setUserEmail] = useState('');
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [isInitializing, setIsInitializing] = useState(true);
      const [firebaseReady, setFirebaseReady] = useState(false);
      const [dataLoaded, setDataLoaded] = useState(false);
      const [accounts, setAccounts] = useState([]);
      const [trades, setTrades] = useState([]);
      const [selectedAccount, setSelectedAccount] = useState(null);
      const [currentView, setCurrentView] = useState('accounts');
      const [showAccountModal, setShowAccountModal] = useState(false);
      const [showTradeModal, setShowTradeModal] = useState(false);
      const [showPayoutModal, setShowPayoutModal] = useState(false);
      const [editingAccount, setEditingAccount] = useState(null);
      const [editingTrade, setEditingTrade] = useState(null);
      const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
      const [hoveredDay, setHoveredDay] = useState(null);
      const hoverTimeoutRef = useRef(null);
      
      const [newAccount, setNewAccount] = useState({
        name: '', type: 'EVAL', initialBalance: 0, currentBalance: 0, maxLossLimit: 0
      });

      const [newTrade, setNewTrade] = useState({
        date: new Date().toISOString().split('T')[0],
        time: '09:30',
        symbol: 'NQ',
        direction: 'LONG',
        contracts: 1,
        entryPrice: 0,
        exitPrice: 0,
        pnl: 0,
        strategy: '',
        notes: '',
        imageUrl: '',
        accountId: null
      });

      const [payoutData, setPayoutData] = useState({
        amount: 0,
        date: new Date().toISOString().split('T')[0],
        notes: ''
      });

      // Listen for Firebase modules ready
      useEffect(() => {
        const handleFirebaseReady = () => {
          setFirebaseReady(true);
          console.log('âœ… Firebase modules ready');
        };

        if (window.firebaseModules) {
          setFirebaseReady(true);
        } else {
          window.addEventListener('firebaseModulesReady', handleFirebaseReady);
        }

        return () => window.removeEventListener('firebaseModulesReady', handleFirebaseReady);
      }, []);

      // Authentication state listener
      useEffect(() => {
        if (!firebaseReady) return;

        const auth = window.firebaseAuth;
        const { onAuthStateChanged } = window.firebaseModules;

        const unsubscribe = onAuthStateChanged(auth, (user) => {
          if (user) {
            setUserId(user.uid);
            setUserEmail(user.email);
            setIsAuthenticated(true);
            setIsInitializing(false);
            console.log('âœ… User authenticated:', user.email);
          } else {
            setUserId(null);
            setUserEmail('');
            setIsAuthenticated(false);
            setDataLoaded(false);
            setIsInitializing(false);
            console.log('âŒ User not authenticated - showing login screen');
          }
        });

        return () => unsubscribe();
      }, [firebaseReady]);

      // Load data from Firestore when user is authenticated
      useEffect(() => {
        if (!firebaseReady || !userId || !isAuthenticated) return;

        console.log('ğŸ“¥ Loading from Firestore...');
        const { collection, getDocs } = window.firebaseModules;
        const db = window.firebaseDB;

        let accountsLoaded = false;
        let tradesLoaded = false;

        const checkBothLoaded = () => {
          if (accountsLoaded && tradesLoaded) {
            setDataLoaded(true);
            console.log('âœ… All data loaded');
          }
        };

        // Load accounts
        getDocs(collection(db, `users/${userId}/accounts`))
          .then((snapshot) => {
            const accountsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setAccounts(accountsData);
            console.log('âœ… Loaded', accountsData.length, 'accounts from Firestore');
          })
          .catch((error) => {
            console.error('âŒ Error loading accounts:', error);
            // Fallback to localStorage
            const saved = localStorage.getItem('tradingData');
            if (saved) {
              const data = JSON.parse(saved);
              setAccounts(data.accounts || []);
            }
          })
          .finally(() => {
            accountsLoaded = true;
            checkBothLoaded();
          });

        // Load trades
        getDocs(collection(db, `users/${userId}/trades`))
          .then((snapshot) => {
            const tradesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setTrades(tradesData);
            console.log('âœ… Loaded', tradesData.length, 'trades from Firestore');
          })
          .catch((error) => {
            console.error('âŒ Error loading trades:', error);
            // Fallback to localStorage
            const saved = localStorage.getItem('tradingData');
            if (saved) {
              const data = JSON.parse(saved);
              setTrades(data.trades || []);
            }
          })
          .finally(() => {
            tradesLoaded = true;
            checkBothLoaded();
          });
      }, [firebaseReady, userId, isAuthenticated]);

      // Save to both Firestore and localStorage
      useEffect(() => {
        if (!firebaseReady || !userId) return;
        if (accounts.length === 0 && trades.length === 0) return;

        console.log('ğŸ’¾ Saving to Firestore...');
        
        // Save to localStorage as backup
        localStorage.setItem('tradingData', JSON.stringify({ accounts, trades }));
        
        // Note: Individual saves happen in add/update/delete functions
        // This effect is just for the initial sync
      }, [accounts, trades, firebaseReady, userId]);

      // Remove loading screen when initialization is complete
      useEffect(() => {
        // Only remove loading screen after:
        // 1. Firebase is ready AND initialization is complete
        // 2. Either data is loaded (user authenticated) OR user is not authenticated
        if (!isInitializing && firebaseReady && (dataLoaded || !isAuthenticated)) {
          console.log('ğŸ‰ Initialization complete - removing loading screen...');
          console.log('   - isAuthenticated:', isAuthenticated);
          console.log('   - dataLoaded:', dataLoaded);
          
          // Use requestAnimationFrame to ensure React has rendered
          requestAnimationFrame(() => {
            requestAnimationFrame(() => {
              setTimeout(() => {
                const loadingScreen = document.getElementById('loading-screen');
                if (loadingScreen) {
                  loadingScreen.style.opacity = '0';
                  loadingScreen.style.transition = 'opacity 0.5s ease-out';
                  setTimeout(() => {
                    loadingScreen.remove();
                    console.log('âœ… Loading screen removed');
                  }, 500);
                }
              }, 300); // Increased delay to ensure AuthScreen is rendered
            });
          });
        }
      }, [isInitializing, dataLoaded, isAuthenticated, firebaseReady]);

      // Safety timeout - remove loading screen after 10 seconds no matter what
      useEffect(() => {
        const timeout = setTimeout(() => {
          const loadingScreen = document.getElementById('loading-screen');
          if (loadingScreen) {
            console.log('âš ï¸ Safety timeout - removing loading screen');
            loadingScreen.remove();
          }
        }, 10000);
        return () => clearTimeout(timeout);
      }, []);

      useEffect(() => {
        return () => {
          if (hoverTimeoutRef.current) {
            clearTimeout(hoverTimeoutRef.current);
          }
        };
      }, []);

      // Firestore Helper Functions
      const saveAccountToFirestore = async (account) => {
        if (!firebaseReady || !userId) return;
        try {
          const { doc, setDoc } = window.firebaseModules;
          const db = window.firebaseDB;
          await setDoc(doc(db, `users/${userId}/accounts`, account.id.toString()), account);
          console.log('âœ… Account saved to Firestore:', account.name);
        } catch (error) {
          console.error('âŒ Error saving account:', error);
        }
      };

      const deleteAccountFromFirestore = async (accountId) => {
        if (!firebaseReady || !userId) return;
        try {
          const { doc, deleteDoc } = window.firebaseModules;
          const db = window.firebaseDB;
          await deleteDoc(doc(db, `users/${userId}/accounts`, accountId.toString()));
          console.log('âœ… Account deleted from Firestore');
        } catch (error) {
          console.error('âŒ Error deleting account:', error);
        }
      };

      const saveTradeToFirestore = async (trade) => {
        if (!firebaseReady || !userId) return;
        try {
          const { doc, setDoc } = window.firebaseModules;
          const db = window.firebaseDB;
          await setDoc(doc(db, `users/${userId}/trades`, trade.id.toString()), trade);
          console.log('âœ… Trade saved to Firestore');
        } catch (error) {
          console.error('âŒ Error saving trade:', error);
        }
      };

      const deleteTradeFromFirestore = async (tradeId) => {
        if (!firebaseReady || !userId) return;
        try {
          const { doc, deleteDoc } = window.firebaseModules;
          const db = window.firebaseDB;
          await deleteDoc(doc(db, `users/${userId}/trades`, tradeId.toString()));
          console.log('âœ… Trade deleted from Firestore');
        } catch (error) {
          console.error('âŒ Error deleting trade:', error);
        }
      };

      const handleDayMouseEnter = (day) => {
        if (hoverTimeoutRef.current) {
          clearTimeout(hoverTimeoutRef.current);
        }
        setHoveredDay(day);
      };

      const handleDayMouseLeave = () => {
        hoverTimeoutRef.current = setTimeout(() => {
          setHoveredDay(null);
        }, 300); // 300ms delay to allow moving to popup
      };

      const handlePopupMouseEnter = () => {
        if (hoverTimeoutRef.current) {
          clearTimeout(hoverTimeoutRef.current);
        }
      };

      const handlePopupMouseLeave = () => {
        setHoveredDay(null);
      };

      const getSymbolMultiplier = (symbol) => {
        const m = { 'NQ': 20, 'ES': 50, 'MNQ': 2, 'MES': 5 };
        return m[symbol] || 1;
      };

      const calculatePnL = (trade) => {
        const mult = getSymbolMultiplier(trade.symbol);
        const diff = trade.direction === 'LONG' 
          ? (trade.exitPrice - trade.entryPrice) 
          : (trade.entryPrice - trade.exitPrice);
        return diff * mult * trade.contracts;
      };

      const addAccount = () => {
        if (!newAccount.name || newAccount.initialBalance <= 0) {
          alert('× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª');
          return;
        }
        const acc = {
          ...newAccount,
          id: Date.now(),
          currentBalance: newAccount.initialBalance,
          payouts: []
        };
        setAccounts([...accounts, acc]);
        saveAccountToFirestore(acc); // Save to Firebase
        setNewAccount({ name: '', type: 'EVAL', initialBalance: 0, currentBalance: 0, maxLossLimit: 0 });
        setShowAccountModal(false);
        console.log('âœ… Account added:', acc.name);
      };

      const updateAccount = () => {
        setAccounts(accounts.map(a => a.id === editingAccount.id ? editingAccount : a));
        saveAccountToFirestore(editingAccount); // Save to Firebase
        setEditingAccount(null);
        setShowAccountModal(false);
      };

      const deleteAccount = (id) => {
        if (confirm('×œ××—×•×§ ×ª×™×§?')) {
          setAccounts(accounts.filter(a => a.id !== id));
          setTrades(trades.filter(t => t.accountId !== id));
          deleteAccountFromFirestore(id); // Delete from Firebase
          if (selectedAccount?.id === id) setSelectedAccount(null);
        }
      };

      const addTrade = () => {
        if (!newTrade.accountId) {
          alert('×‘×—×¨ ×ª×™×§ ×ª×—×™×œ×”');
          return;
        }
        
        const pnl = calculatePnL(newTrade);
        const account = accounts.find(a => a.id === newTrade.accountId);
        
        // Check MLL for EVAL accounts
        if (account.type === 'EVAL' && account.maxLossLimit > 0 && pnl < 0) {
          const today = newTrade.date;
          const todayTrades = trades.filter(t => t.accountId === newTrade.accountId && t.date === today);
          const todayLoss = todayTrades.reduce((sum, t) => sum + (t.pnl < 0 ? t.pnl : 0), 0);
          const totalLoss = todayLoss + pnl;
          
          if (Math.abs(totalLoss) > account.maxLossLimit) {
            const proceed = confirm(
              `âš ï¸ ××–×”×¨×”: MLL\n\n` +
              `×”×¤×¡×“ ×™×•××™ × ×•×›×—×™: $${Math.abs(todayLoss).toFixed(2)}\n` +
              `×”×¤×¡×“ ×‘×¢×¡×§×” ×–×•: $${Math.abs(pnl).toFixed(2)}\n` +
              `×¡×”"×› ×”×¤×¡×“: $${Math.abs(totalLoss).toFixed(2)}\n\n` +
              `MLL (Maximum Loss Limit): $${account.maxLossLimit}\n\n` +
              `âš ï¸ You have exceeded the Maximum Loss Limit!\n` +
              `×”×× ×œ×”××©×™×š ×‘×›×œ ×–××ª?`
            );
            if (!proceed) return;
          }
        }
        
        const trade = { ...newTrade, id: Date.now(), pnl };
        setTrades([...trades, trade]);
        saveTradeToFirestore(trade); // Save to Firebase
        
        const updatedAccounts = accounts.map(a => 
          a.id === newTrade.accountId 
            ? { ...a, currentBalance: a.currentBalance + pnl }
            : a
        );
        setAccounts(updatedAccounts);
        const updatedAccount = updatedAccounts.find(a => a.id === newTrade.accountId);
        if (updatedAccount) saveAccountToFirestore(updatedAccount); // Update balance in Firebase
        
        setNewTrade({
          ...newTrade,
          date: new Date().toISOString().split('T')[0],
          entryPrice: 0,
          exitPrice: 0,
          notes: '',
          strategy: '',
          imageUrl: ''
        });
        setShowTradeModal(false);
        console.log('âœ… Trade added');
      };

      const updateTrade = () => {
        const old = trades.find(t => t.id === editingTrade.id);
        const newPnl = calculatePnL(editingTrade);
        const updatedTrade = { ...editingTrade, pnl: newPnl };
        setTrades(trades.map(t => t.id === editingTrade.id ? updatedTrade : t));
        saveTradeToFirestore(updatedTrade); // Update in Firebase
        
        const updatedAccounts = accounts.map(a => 
          a.id === editingTrade.accountId 
            ? { ...a, currentBalance: a.currentBalance - old.pnl + newPnl }
            : a
        );
        setAccounts(updatedAccounts);
        const updatedAccount = updatedAccounts.find(a => a.id === editingTrade.accountId);
        if (updatedAccount) saveAccountToFirestore(updatedAccount); // Update balance in Firebase
        
        setEditingTrade(null);
        setShowTradeModal(false);
      };

      const deleteTrade = (id) => {
        if (confirm('×œ××—×•×§ ×¢×¡×§×”?')) {
          const trade = trades.find(t => t.id === id);
          setTrades(trades.filter(t => t.id !== id));
          deleteTradeFromFirestore(id); // Delete from Firebase
          
          const updatedAccounts = accounts.map(a => 
            a.id === trade.accountId 
              ? { ...a, currentBalance: a.currentBalance - trade.pnl }
              : a
          );
          setAccounts(updatedAccounts);
          const updatedAccount = updatedAccounts.find(a => a.id === trade.accountId);
          if (updatedAccount) saveAccountToFirestore(updatedAccount); // Update balance in Firebase
        }
      };

      const processPayout = () => {
        const amount = parseFloat(payoutData.amount);
        if (amount <= 0 || amount > selectedAccount.currentBalance) {
          alert('×¡×›×•× ×œ× ×ª×§×™×Ÿ');
          return;
        }
        const payout = { id: Date.now(), amount, date: payoutData.date, notes: payoutData.notes };
        const updatedAccounts = accounts.map(a => 
          a.id === selectedAccount.id 
            ? {
                ...a,
                currentBalance: a.currentBalance - amount,
                payouts: [...(a.payouts || []), payout]
              }
            : a
        );
        setAccounts(updatedAccounts);
        const updatedAccount = updatedAccounts.find(a => a.id === selectedAccount.id);
        if (updatedAccount) saveAccountToFirestore(updatedAccount); // Save payout to Firebase
        
        setPayoutData({ amount: 0, date: new Date().toISOString().split('T')[0], notes: '' });
        setShowPayoutModal(false);
      };

      const getAccountTrades = (accountId) => trades.filter(t => t.accountId === accountId);

      const getTradesByDate = (date) => {
        if (!selectedAccount) return [];
        return trades.filter(t => t.accountId === selectedAccount.id && t.date === date);
      };

      const generateCalendarDays = () => {
        const year = parseInt(selectedDate.split('-')[0]);
        const month = parseInt(selectedDate.split('-')[1]);
        const firstDay = new Date(year, month - 1, 1);
        const lastDay = new Date(year, month, 0);
        const daysInMonth = lastDay.getDate();
        const startingDayOfWeek = firstDay.getDay();
        
        const days = [];
        for (let i = 0; i < startingDayOfWeek; i++) days.push(null);
        
        for (let day = 1; day <= daysInMonth; day++) {
          const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          const dayTrades = getTradesByDate(dateStr);
          const dayPnL = dayTrades.reduce((s, t) => s + t.pnl, 0);
          
          days.push({
            day, date: dateStr, trades: dayTrades,
            tradesCount: dayTrades.length, pnl: dayPnL
          });
        }
        return days;
      };

      const calculateStats = (tradesArr) => {
        if (tradesArr.length === 0) {
          return { totalTrades: 0, winners: 0, losers: 0, winRate: 0, totalPnL: 0 };
        }
        const winners = tradesArr.filter(t => t.pnl > 0);
        const losers = tradesArr.filter(t => t.pnl < 0);
        const totalPnL = tradesArr.reduce((s, t) => s + t.pnl, 0);
        return {
          totalTrades: tradesArr.length,
          winners: winners.length,
          losers: losers.length,
          winRate: (winners.length / tradesArr.length) * 100,
          totalPnL
        };
      };

      const handleImageUpload = (e, isEditing = false) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            alert('×”×ª××•× ×” ×’×“×•×œ×” ××“×™. ××§×¡×™××•× 5MB');
            return;
          }
          const reader = new FileReader();
          reader.onloadend = () => {
            if (isEditing) {
              setEditingTrade({ ...editingTrade, imageUrl: reader.result });
            } else {
              setNewTrade({ ...newTrade, imageUrl: reader.result });
            }
          };
          reader.readAsDataURL(file);
        }
      };

      const handleLogout = async () => {
        if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ×”×ª× ×ª×§?')) {
          try {
            const auth = window.firebaseAuth;
            const { signOut } = window.firebaseModules;
            await signOut(auth);
            setAccounts([]);
            setTrades([]);
            setSelectedAccount(null);
            console.log('âœ… Logged out');
          } catch (error) {
            console.error('âŒ Logout error:', error);
            alert('×©×’×™××” ×‘×”×ª× ×ª×§×•×ª');
          }
        }
      };

      console.log('âœ… App rendered successfully');
      console.log('   - isInitializing:', isInitializing);
      console.log('   - isAuthenticated:', isAuthenticated);
      console.log('   - firebaseReady:', firebaseReady);

      // Show nothing while initializing - loading screen will show
      if (isInitializing) {
        console.log('â³ Still initializing...');
        return null;
      }

      // Show AuthScreen if not authenticated
      if (!isAuthenticated) {
        console.log('ğŸ”“ User not authenticated - showing AuthScreen');
        return <AuthScreen />;
      }

      console.log('ğŸ”’ User authenticated - showing main app');

      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 p-4">
          <div className="max-w-7xl mx-auto">
            {/* Header */}
            <div className="bg-gray-900/90 backdrop-blur-xl rounded-2xl p-6 border border-cyan-500/30 mb-6">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className="p-3 bg-cyan-500 rounded-xl">
                    <ChartIcon size={32} className="text-white" />
                  </div>
                  <div>
                    <h1 className="text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-400 bg-clip-text text-transparent">
                      ×™×•××Ÿ ××¡×—×¨
                    </h1>
                    <p className="text-sm text-cyan-400 mt-1 flex items-center gap-2">
                      <UserIcon size={14} />
                      {userEmail}
                    </p>
                  </div>
                </div>
                <button
                  onClick={handleLogout}
                  className="p-3 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-xl transition-all group"
                  title="×”×ª× ×ª×§"
                >
                  <LogOutIcon size={24} className="text-red-400 group-hover:text-red-300" />
                </button>
              </div>
              
              <div className="flex gap-3 mb-4">
                <button
                  onClick={() => setCurrentView('dashboard')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    currentView === 'dashboard' 
                      ? 'bg-cyan-500 text-white' 
                      : 'bg-gray-800 text-gray-300'
                  }`}
                >
                  ×œ×•×— ×‘×§×¨×”
                </button>
                <button
                  onClick={() => setCurrentView('calendar')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    currentView === 'calendar' 
                      ? 'bg-cyan-500 text-white' 
                      : 'bg-gray-800 text-gray-300'
                  }`}
                >
                  ×œ×•×— ×©× ×”
                </button>
                <button
                  onClick={() => setCurrentView('accounts')}
                  className={`px-6 py-3 rounded-xl font-semibold transition-all ${
                    currentView === 'accounts' 
                      ? 'bg-cyan-500 text-white' 
                      : 'bg-gray-800 text-gray-300'
                  }`}
                >
                  × ×™×”×•×œ ×ª×™×§×™×
                </button>
              </div>

              <div className="flex gap-3">
                <button
                  onClick={() => { setShowAccountModal(true); setEditingAccount(null); }}
                  className="px-6 py-3 bg-emerald-500 text-white rounded-xl hover:bg-emerald-600 font-semibold flex items-center gap-2"
                >
                  <PlusIcon size={20} />
                  ×ª×™×§ ×—×“×©
                </button>
                <button
                  onClick={() => {
                    if (!selectedAccount) { alert('×‘×—×¨ ×ª×™×§ ×ª×—×™×œ×”'); return; }
                    setNewTrade({ ...newTrade, accountId: selectedAccount.id });
                    setShowTradeModal(true);
                  }}
                  className="px-6 py-3 bg-cyan-500 text-white rounded-xl hover:bg-cyan-600 font-semibold flex items-center gap-2"
                >
                  <PlusIcon size={20} />
                  ×¢×¡×§×” ×—×“×©×”
                </button>
              </div>

              {selectedAccount && (
                <div className="mt-4 p-4 bg-cyan-500/10 rounded-xl border border-cyan-500/30">
                  <span className="text-gray-300">×ª×™×§ × ×‘×—×¨: </span>
                  <span className="text-cyan-400 font-bold">{selectedAccount.name}</span>
                  <span className="mx-3 text-gray-600">|</span>
                  <span className="text-gray-300">×™×ª×¨×”: </span>
                  <span className="text-cyan-400 font-bold">${selectedAccount.currentBalance.toLocaleString()}</span>
                </div>
              )}
            </div>

            {/* Main Content */}
            {currentView === 'dashboard' && (
              <div>
                {!selectedAccount ? (
                  <div className="text-center py-20 text-white">
                    <SettingsIcon size={64} className="mx-auto mb-4 text-cyan-400" />
                    <h2 className="text-3xl font-bold mb-4">×‘×—×¨ ×ª×™×§ ×›×“×™ ×œ×”×ª×—×™×œ</h2>
                  </div>
                ) : (
                  <div className="space-y-6">
                    {/* Account Selector */}
                    <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-cyan-500/30">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm text-gray-400 flex items-center gap-2">
                          <SettingsIcon size={16} />
                          ×ª×™×§ ×¤×¢×™×œ
                        </label>
                        <button
                          onClick={() => setCurrentView('accounts')}
                          className="text-xs text-cyan-400 hover:text-cyan-300 underline flex items-center gap-1"
                        >
                          × ×™×”×•×œ ×ª×™×§×™× â†’
                        </button>
                      </div>
                      <div className="relative">
                        <select
                          value={selectedAccount.id}
                          onChange={(e) => setSelectedAccount(accounts.find(a => a.id === parseInt(e.target.value)))}
                          className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200 font-semibold text-lg appearance-none cursor-pointer hover:border-cyan-500/50 transition-colors"
                        >
                          {accounts.map(acc => (
                            <option key={acc.id} value={acc.id}>
                              {acc.name} ({acc.type}) - ${acc.currentBalance.toLocaleString()}
                            </option>
                          ))}
                        </select>
                        <div className="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" className="text-cyan-400">
                            <path d="M6 8l4 4 4-4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                          </svg>
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mt-2">
                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                          selectedAccount.type === 'EVAL' ? 'bg-yellow-500/20 text-yellow-300' :
                          selectedAccount.type === 'EXPRESS' ? 'bg-purple-500/20 text-purple-300' :
                          'bg-emerald-500/20 text-emerald-300'
                        }`}>
                          {selectedAccount.type}
                        </span>
                        <span className="text-sm text-gray-400">
                          ×™×ª×¨×”: <span className="font-bold text-cyan-400">${selectedAccount.currentBalance.toLocaleString()}</span>
                        </span>
                        <span className="text-sm text-gray-400">â€¢</span>
                        <span className="text-sm text-gray-400">
                          {getAccountTrades(selectedAccount.id).length} ×¢×¡×§××•×ª
                        </span>
                      </div>
                    </div>

                    {/* Stats */}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                      {(() => {
                        const stats = calculateStats(getAccountTrades(selectedAccount.id));
                        return (
                          <>
                            <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-cyan-500/20">
                              <p className="text-gray-400 text-sm mb-1">×¡×”"×› ×¢×¡×§××•×ª</p>
                              <p className="text-3xl font-bold text-gray-100">{stats.totalTrades}</p>
                            </div>
                            <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-emerald-500/20">
                              <p className="text-gray-400 text-sm mb-1">Win Rate</p>
                              <p className="text-3xl font-bold text-emerald-400">{stats.winRate.toFixed(1)}%</p>
                            </div>
                            <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-green-500/20">
                              <p className="text-gray-400 text-sm mb-1">× ×¦×—×•× ×•×ª</p>
                              <p className="text-3xl font-bold text-emerald-400">{stats.winners}</p>
                            </div>
                            <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-red-500/20">
                              <p className="text-gray-400 text-sm mb-1">×”×¤×¡×“×™×</p>
                              <p className="text-3xl font-bold text-red-400">{stats.losers}</p>
                            </div>
                          </>
                        );
                      })()}
                    </div>

                    {selectedAccount.type === 'EVAL' && selectedAccount.maxLossLimit > 0 && (() => {
                      const today = new Date().toISOString().split('T')[0];
                      const todayTrades = trades.filter(t => t.accountId === selectedAccount.id && t.date === today);
                      const todayLoss = todayTrades.reduce((sum, t) => sum + (t.pnl < 0 ? t.pnl : 0), 0);
                      const lossPercentage = (Math.abs(todayLoss) / selectedAccount.maxLossLimit) * 100;
                      
                      return (
                        <div className={`bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border-2 ${
                          lossPercentage > 80 ? 'border-red-500/50 bg-red-500/10' : 
                          lossPercentage > 50 ? 'border-yellow-500/50 bg-yellow-500/10' : 
                          'border-cyan-500/20'
                        }`}>
                          <div className="flex items-center justify-between mb-2">
                            <h4 className="text-lg font-bold text-cyan-400">MLL (Maximum Loss Limit)</h4>
                            <span className={`text-2xl font-bold ${
                              lossPercentage > 80 ? 'text-red-400' : 
                              lossPercentage > 50 ? 'text-yellow-400' : 
                              'text-emerald-400'
                            }`}>
                              {lossPercentage.toFixed(0)}%
                            </span>
                          </div>
                          <div className="flex items-center justify-between text-sm">
                            <span className="text-gray-400">×”×¤×¡×“ ×”×™×•×: <span className="font-bold text-red-400">${Math.abs(todayLoss).toFixed(2)}</span></span>
                            <span className="text-gray-400">××’×‘×œ×”: <span className="font-bold text-yellow-400">${selectedAccount.maxLossLimit}</span></span>
                          </div>
                          <div className="mt-2 h-2 bg-gray-700 rounded-full overflow-hidden">
                            <div 
                              className={`h-full transition-all ${
                                lossPercentage > 80 ? 'bg-red-500' : 
                                lossPercentage > 50 ? 'bg-yellow-500' : 
                                'bg-emerald-500'
                              }`}
                              style={{ width: `${Math.min(lossPercentage, 100)}%` }}
                            />
                          </div>
                          {lossPercentage > 80 && (
                            <p className="text-xs text-red-400 mt-2 font-semibold">âš ï¸ Warning: Approaching Maximum Loss Limit!</p>
                          )}
                        </div>
                      );
                    })()}

                    {/* Trades Table */}
                    <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl border border-cyan-500/20 overflow-hidden">
                      <div className="p-6 border-b border-gray-700/50">
                        <h3 className="text-2xl font-bold text-cyan-400">×”×™×¡×˜×•×¨×™×™×ª ×¢×¡×§××•×ª</h3>
                      </div>
                      <div className="overflow-x-auto">
                        <table className="w-full">
                          <thead className="bg-gray-800/50">
                            <tr>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×ª××¨×™×š</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×¡×™××‘×•×œ</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×›×™×•×•×Ÿ</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×›× ×™×¡×”</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×™×¦×™××”</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">P&L</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×ª××•× ×”</th>
                              <th className="px-4 py-3 text-right text-sm text-gray-400">×¤×¢×•×œ×•×ª</th>
                            </tr>
                          </thead>
                          <tbody>
                            {getAccountTrades(selectedAccount.id).length === 0 ? (
                              <tr><td colSpan="8" className="px-4 py-8 text-center text-gray-500">××™×Ÿ ×¢×¡×§××•×ª</td></tr>
                            ) : (
                              getAccountTrades(selectedAccount.id).map(trade => (
                                <tr key={trade.id} className="border-b border-gray-800/50 hover:bg-gray-800/30">
                                  <td className="px-4 py-3 text-gray-300 text-sm">{trade.date}</td>
                                  <td className="px-4 py-3 text-cyan-400 font-semibold">{trade.symbol}</td>
                                  <td className="px-4 py-3">
                                    <span className={`px-2 py-1 rounded text-xs ${
                                      trade.direction === 'LONG' ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'
                                    }`}>{trade.direction}</span>
                                  </td>
                                  <td className="px-4 py-3 text-gray-300 text-sm">{trade.entryPrice}</td>
                                  <td className="px-4 py-3 text-gray-300 text-sm">{trade.exitPrice}</td>
                                  <td className="px-4 py-3">
                                    <span className={`font-bold ${trade.pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                      {trade.pnl >= 0 ? '+' : ''}{trade.pnl.toFixed(2)}
                                    </span>
                                  </td>
                                  <td className="px-4 py-3">
                                    {trade.imageUrl ? (
                                      <img 
                                        src={trade.imageUrl} 
                                        alt="×ª××•× ×ª ×¢×¡×§×”" 
                                        className="w-12 h-12 object-cover rounded-lg border border-cyan-500/30 cursor-pointer hover:scale-150 transition-transform"
                                        onClick={() => window.open(trade.imageUrl, '_blank')}
                                      />
                                    ) : (
                                      <span className="text-gray-600 text-xs">××™×Ÿ ×ª××•× ×”</span>
                                    )}
                                  </td>
                                  <td className="px-4 py-3">
                                    <div className="flex gap-2">
                                      <button onClick={() => { setEditingTrade(trade); setShowTradeModal(true); }} className="p-1 text-blue-400 hover:bg-blue-500/20 rounded">
                                        <EditIcon size={16} />
                                      </button>
                                      <button onClick={() => deleteTrade(trade.id)} className="p-1 text-red-400 hover:bg-red-500/20 rounded">
                                        <TrashIcon size={16} />
                                      </button>
                                    </div>
                                  </td>
                                </tr>
                              ))
                            )}
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}

            {currentView === 'calendar' && (
              <div>
                {!selectedAccount ? (
                  <div className="text-center py-20 text-white">
                    <CalendarIcon size={64} className="mx-auto mb-4 text-cyan-400" />
                    <h2 className="text-3xl font-bold mb-4">×‘×—×¨ ×ª×™×§ ×›×“×™ ×œ×¨××•×ª ×œ×•×— ×©× ×”</h2>
                  </div>
                ) : (
                  <div className="space-y-4">
                    {/* Account Selector */}
                    <div className="bg-gray-900/90 backdrop-blur-xl rounded-xl p-4 border border-cyan-500/30">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm text-gray-400 flex items-center gap-2">
                          <CalendarIcon size={16} />
                          ×ª×™×§ ×¤×¢×™×œ
                        </label>
                        <button
                          onClick={() => setCurrentView('accounts')}
                          className="text-xs text-cyan-400 hover:text-cyan-300 underline flex items-center gap-1"
                        >
                          × ×™×”×•×œ ×ª×™×§×™× â†’
                        </button>
                      </div>
                      <div className="relative">
                        <select
                          value={selectedAccount.id}
                          onChange={(e) => setSelectedAccount(accounts.find(a => a.id === parseInt(e.target.value)))}
                          className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200 font-semibold text-lg appearance-none cursor-pointer hover:border-cyan-500/50 transition-colors"
                        >
                          {accounts.map(acc => (
                            <option key={acc.id} value={acc.id}>
                              {acc.name} ({acc.type}) - ${acc.currentBalance.toLocaleString()}
                            </option>
                          ))}
                        </select>
                        <div className="absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none">
                          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" className="text-cyan-400">
                            <path d="M6 8l4 4 4-4" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                          </svg>
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mt-2">
                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${
                          selectedAccount.type === 'EVAL' ? 'bg-yellow-500/20 text-yellow-300' :
                          selectedAccount.type === 'EXPRESS' ? 'bg-purple-500/20 text-purple-300' :
                          'bg-emerald-500/20 text-emerald-300'
                        }`}>
                          {selectedAccount.type}
                        </span>
                        <span className="text-sm text-gray-400">
                          ×™×ª×¨×”: <span className="font-bold text-cyan-400">${selectedAccount.currentBalance.toLocaleString()}</span>
                        </span>
                        <span className="text-sm text-gray-400">â€¢</span>
                        <span className="text-sm text-gray-400">
                          {getAccountTrades(selectedAccount.id).length} ×¢×¡×§××•×ª
                        </span>
                      </div>
                    </div>

                    {/* Calendar */}
                    <div className="bg-gray-900/90 backdrop-blur-xl rounded-2xl p-6 border border-cyan-500/20 overflow-visible">
                    <div className="flex justify-between items-center mb-6">
                      <h2 className="text-3xl font-bold text-cyan-400">×œ×•×— ×©× ×” - ×™×•××Ÿ ×¢×¡×§××•×ª</h2>
                      <input
                        type="month"
                        value={selectedDate.substring(0, 7)}
                        onChange={(e) => setSelectedDate(`${e.target.value}-01`)}
                        className="px-4 py-2 bg-gray-800/50 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div className="grid grid-cols-7 gap-2">
                      {['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'].map(day => (
                        <div key={day} className="text-center font-semibold text-gray-400 py-3 text-sm">
                          {day}
                        </div>
                      ))}
                      
                      {generateCalendarDays().map((day, index) => (
                        <div
                          key={index}
                          className={`relative min-h-24 rounded-xl p-2 transition-all ${
                            day ? (
                              day.pnl > 0 
                                ? 'bg-emerald-500/10 border border-emerald-500/30 hover:bg-emerald-500/20 cursor-pointer' 
                                : day.pnl < 0 
                                  ? 'bg-red-500/10 border border-red-500/30 hover:bg-red-500/20 cursor-pointer' 
                                  : day.tradesCount > 0 
                                    ? 'bg-gray-800/30 border border-gray-700 hover:bg-gray-800/50 cursor-pointer'
                                    : 'bg-gray-800/20 border border-gray-700/30'
                            ) : ''
                          }`}
                          onMouseEnter={() => day && day.tradesCount > 0 && handleDayMouseEnter(day)}
                          onMouseLeave={handleDayMouseLeave}
                        >
                          {day && (
                            <>
                              <div className="font-semibold text-sm mb-1 text-gray-300">{day.day}</div>
                              {day.tradesCount > 0 && (
                                <div className="text-xs space-y-1">
                                  <div className="text-gray-400">{day.tradesCount} ×¢×¡×§××•×ª</div>
                                  <div className={`font-bold text-sm ${day.pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                    {day.pnl >= 0 ? '+' : ''}{day.pnl.toFixed(0)}
                                  </div>
                                </div>
                              )}
                              
                              {hoveredDay?.date === day.date && (
                                <div 
                                  className="absolute z-50 bg-gray-900/95 backdrop-blur-xl rounded-xl border border-cyan-500/30 shadow-2xl"
                                  onMouseEnter={handlePopupMouseEnter}
                                  onMouseLeave={handlePopupMouseLeave}
                                  style={(() => {
                                    const isMobile = window.innerWidth < 768;
                                    const isTopHalf = index < 14;
                                    const isRightSide = (index % 7) < 4;
                                    
                                    if (isMobile) {
                                      return {
                                        top: isTopHalf ? '100%' : 'auto',
                                        bottom: !isTopHalf ? '100%' : 'auto',
                                        left: '50%',
                                        transform: 'translateX(-50%)',
                                        marginTop: isTopHalf ? '8px' : '0',
                                        marginBottom: !isTopHalf ? '8px' : '0',
                                        width: '90vw',
                                        maxWidth: '350px',
                                        maxHeight: '70vh',
                                        display: 'flex',
                                        flexDirection: 'column'
                                      };
                                    }
                                    
                                    return {
                                      top: isTopHalf ? '100%' : 'auto',
                                      bottom: !isTopHalf ? '100%' : 'auto',
                                      right: !isRightSide ? 'auto' : '100%',
                                      left: !isRightSide ? '100%' : 'auto',
                                      marginTop: isTopHalf ? '8px' : '0',
                                      marginBottom: !isTopHalf ? '8px' : '0',
                                      marginRight: isRightSide ? '8px' : '0',
                                      marginLeft: !isRightSide ? '8px' : '0',
                                      minWidth: '320px',
                                      maxWidth: '400px',
                                      maxHeight: '85vh',
                                      display: 'flex',
                                      flexDirection: 'column'
                                    };
                                  })()}
                                >
                                    <div className="p-4 pb-3 border-b border-gray-700 flex-shrink-0">
                                      <h3 className="font-bold text-lg text-cyan-400">{day.date}</h3>
                                      <div className="flex justify-between items-center mt-1">
                                        <span className="text-gray-400 text-sm">{day.tradesCount} ×¢×¡×§××•×ª</span>
                                        <span className={`font-bold text-lg ${day.pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                          {day.pnl >= 0 ? '+' : ''}{day.pnl.toFixed(2)}
                                        </span>
                                      </div>
                                    </div>

                                    <div className="p-4 pb-6 space-y-2 overflow-y-auto flex-1 relative" style={{ scrollbarWidth: 'thin', scrollbarColor: '#06b6d4 #1f2937' }}>
                                      {day.trades.map(trade => (
                                        <div key={trade.id} className={`p-3 rounded-lg border-2 ${
                                          trade.pnl >= 0 ? 'bg-emerald-500/10 border-emerald-500/30' : 'bg-red-500/10 border-red-500/30'
                                        }`}>
                                          <div className="flex justify-between items-start mb-2">
                                            <div className="flex items-center gap-2">
                                              <span className="font-bold text-lg text-cyan-300">{trade.symbol}</span>
                                              <span className={`px-2 py-0.5 rounded text-xs font-semibold ${
                                                trade.direction === 'LONG' ? 'bg-emerald-500/30 text-emerald-300' : 'bg-red-500/30 text-red-300'
                                              }`}>{trade.direction}</span>
                                            </div>
                                            <span className={`font-bold text-lg ${trade.pnl >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                              {trade.pnl >= 0 ? '+' : ''}{trade.pnl.toFixed(2)}
                                            </span>
                                          </div>
                                          
                                          <div className="text-xs space-y-1 text-gray-400">
                                            <div className="flex justify-between">
                                              <span>×©×¢×”:</span>
                                              <span className="font-semibold text-gray-300">{trade.time}</span>
                                            </div>
                                            <div className="flex justify-between">
                                              <span>×—×•×–×™×:</span>
                                              <span className="font-semibold text-gray-300">{trade.contracts}</span>
                                            </div>
                                            <div className="flex justify-between">
                                              <span>×›× ×™×¡×” â†’ ×™×¦×™××”:</span>
                                              <span className="font-semibold text-gray-300">{trade.entryPrice} â†’ {trade.exitPrice}</span>
                                            </div>
                                            {trade.strategy && (
                                              <div className="flex justify-between">
                                                <span>××¡×˜×¨×˜×’×™×”:</span>
                                                <span className="font-semibold text-cyan-300">{trade.strategy}</span>
                                              </div>
                                            )}
                                          </div>
                                          
                                          {trade.imageUrl && (
                                            <div className="mt-2 pt-2 border-t border-gray-700">
                                              <img 
                                                src={trade.imageUrl} 
                                                alt="×ª××•× ×ª ×¢×¡×§×”" 
                                                className="w-full h-32 object-cover rounded-lg border border-cyan-500/30 cursor-pointer hover:opacity-80 transition-opacity"
                                                onClick={() => window.open(trade.imageUrl, '_blank')}
                                              />
                                            </div>
                                          )}
                                        </div>
                                      ))}
                                      
                                      {day.tradesCount > 3 && (
                                        <div className="text-center text-xs text-gray-500 pt-2 pb-1">
                                          â†•ï¸ ×’×œ×•×œ ×œ×¨××•×ª ×¢×•×“ ×¢×¡×§××•×ª
                                        </div>
                                      )}
                                    </div>
                                  </div>
                                )}
                            </>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                  </div>
                )}
              </div>
            )}

            {currentView === 'accounts' && (
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {accounts.length === 0 ? (
                  <div className="col-span-full text-center py-12 text-white">
                    <SettingsIcon size={48} className="mx-auto mb-4 text-cyan-400" />
                    <h2 className="text-2xl font-bold mb-4">××™×Ÿ ×ª×™×§×™× ×¢×“×™×™×Ÿ</h2>
                    <p className="text-gray-400">×¦×•×¨ ×ª×™×§ ×—×“×© ×›×“×™ ×œ×”×ª×—×™×œ</p>
                  </div>
                ) : (
                  accounts.map(account => {
                    const stats = calculateStats(getAccountTrades(account.id));
                    const totalPayouts = (account.payouts || []).reduce((s, p) => s + p.amount, 0);
                    const profitLoss = account.currentBalance - account.initialBalance + totalPayouts;
                    
                    return (
                      <div key={account.id} className="bg-gray-900/90 backdrop-blur-xl rounded-2xl p-6 border border-cyan-500/20">
                        <div className="flex justify-between items-start mb-4">
                          <div>
                            <h3 className="text-xl font-bold text-cyan-400">{account.name}</h3>
                            <span className={`inline-block px-3 py-1 rounded-full text-xs font-bold mt-2 ${
                              account.type === 'EVAL' ? 'bg-yellow-500/20 text-yellow-300' :
                              account.type === 'EXPRESS' ? 'bg-purple-500/20 text-purple-300' :
                              'bg-emerald-500/20 text-emerald-300'
                            }`}>{account.type}</span>
                          </div>
                          <div className="flex gap-2">
                            {(account.type === 'EXPRESS' || account.type === 'LIVE') && (
                              <button onClick={() => { setSelectedAccount(account); setShowPayoutModal(true); }} className="p-2 text-emerald-400 hover:bg-emerald-500/20 rounded-lg">
                                <DollarIcon size={20} />
                              </button>
                            )}
                            <button onClick={() => { setSelectedAccount(account); setCurrentView('dashboard'); }} className="p-2 text-cyan-400 hover:bg-cyan-500/20 rounded-lg">
                              <ChartIcon size={20} />
                            </button>
                            <button onClick={() => { setEditingAccount(account); setShowAccountModal(true); }} className="p-2 text-blue-400 hover:bg-blue-500/20 rounded-lg">
                              <EditIcon size={18} />
                            </button>
                            <button onClick={() => deleteAccount(account.id)} className="p-2 text-red-400 hover:bg-red-500/20 rounded-lg">
                              <TrashIcon size={18} />
                            </button>
                          </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-4">
                          <div className="bg-gray-800/40 rounded-lg p-3 border border-gray-700/50">
                            <p className="text-gray-400 text-xs mb-1">×™×ª×¨×”</p>
                            <p className="text-2xl font-bold text-cyan-400">${account.currentBalance.toLocaleString()}</p>
                          </div>
                          <div className="bg-gray-800/40 rounded-lg p-3 border border-gray-700/50">
                            <p className="text-gray-400 text-xs mb-1">×¨×•×•×—/×”×¤×¡×“</p>
                            <p className={`text-2xl font-bold ${profitLoss >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                              {profitLoss >= 0 ? '+' : ''}{profitLoss.toFixed(0)}
                            </p>
                          </div>
                        </div>

                        <div className="grid grid-cols-3 gap-2 text-center text-sm">
                          <div>
                            <p className="text-gray-500 text-xs">×¢×¡×§××•×ª</p>
                            <p className="font-bold text-gray-200">{stats.totalTrades}</p>
                          </div>
                          <div>
                            <p className="text-gray-500 text-xs">Win Rate</p>
                            <p className="font-bold text-emerald-400">{stats.winRate.toFixed(0)}%</p>
                          </div>
                          <div>
                            <p className="text-gray-500 text-xs">P&L</p>
                            <p className={`font-bold ${stats.totalPnL >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                              {stats.totalPnL >= 0 ? '+' : ''}{stats.totalPnL.toFixed(0)}
                            </p>
                          </div>
                        </div>

                        {account.type === 'EVAL' && account.maxLossLimit > 0 && (
                          <div className="mt-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3">
                            <div className="flex justify-between items-center">
                              <span className="text-xs text-yellow-300">MLL (Maximum Loss Limit)</span>
                              <span className="font-bold text-yellow-400">${account.maxLossLimit}</span>
                            </div>
                          </div>
                        )}

                        {(account.type === 'EXPRESS' || account.type === 'LIVE') && (account.payouts || []).length > 0 && (
                          <div className="mt-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg p-3">
                            <div className="flex justify-between items-center mb-2">
                              <span className="text-xs text-emerald-300">×¡×”"×› ××©×™×›×•×ª</span>
                              <span className="font-bold text-emerald-400">${totalPayouts.toFixed(0)}</span>
                            </div>
                            <button 
                              onClick={() => { setSelectedAccount(account); setShowPayoutModal(true); }}
                              className="w-full text-xs text-cyan-400 hover:text-cyan-300 underline"
                            >
                              ×¦×¤×” ×‘×”×™×¡×˜×•×¨×™×™×ª ××©×™×›×•×ª ({account.payouts.length})
                            </button>
                          </div>
                        )}
                      </div>
                    );
                  })
                )}
              </div>
            )}

            {/* Account Modal */}
            {showAccountModal && (
              <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowAccountModal(false); setEditingAccount(null); }}>
                <div className="bg-gray-900 rounded-2xl p-6 border border-cyan-500/30 max-w-md w-full" onClick={e => e.stopPropagation()}>
                  <h2 className="text-2xl font-bold text-cyan-400 mb-4">{editingAccount ? '×¢×¨×™×›×ª ×ª×™×§' : '×ª×™×§ ×—×“×©'}</h2>
                  
                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×©× ×”×ª×™×§</label>
                      <input
                        type="text"
                        value={editingAccount ? editingAccount.name : newAccount.name}
                        onChange={(e) => editingAccount 
                          ? setEditingAccount({ ...editingAccount, name: e.target.value })
                          : setNewAccount({ ...newAccount, name: e.target.value })
                        }
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×¡×•×’ ×ª×™×§</label>
                      <select
                        value={editingAccount ? editingAccount.type : newAccount.type}
                        onChange={(e) => editingAccount
                          ? setEditingAccount({ ...editingAccount, type: e.target.value })
                          : setNewAccount({ ...newAccount, type: e.target.value })
                        }
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      >
                        <option value="EVAL">EVAL</option>
                        <option value="EXPRESS">EXPRESS</option>
                        <option value="LIVE">LIVE</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×™×ª×¨×” ×¨××©×•× ×™×ª ($)</label>
                      <input
                        type="number"
                        value={editingAccount ? editingAccount.initialBalance : newAccount.initialBalance}
                        onChange={(e) => editingAccount
                          ? setEditingAccount({ ...editingAccount, initialBalance: parseFloat(e.target.value) })
                          : setNewAccount({ ...newAccount, initialBalance: parseFloat(e.target.value) })
                        }
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    {(editingAccount ? editingAccount.type === 'EVAL' : newAccount.type === 'EVAL') && (
                      <div>
                        <label className="block text-sm text-gray-300 mb-2">MLL (Maximum Loss Limit) ($)</label>
                        <input
                          type="number"
                          value={editingAccount ? (editingAccount.maxLossLimit || 0) : newAccount.maxLossLimit}
                          onChange={(e) => editingAccount
                            ? setEditingAccount({ ...editingAccount, maxLossLimit: parseFloat(e.target.value) || 0 })
                            : setNewAccount({ ...newAccount, maxLossLimit: parseFloat(e.target.value) || 0 })
                          }
                          className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                          placeholder="0 = ×œ×œ× ×”×’×‘×œ×”"
                        />
                        <p className="text-xs text-gray-500 mt-1">Set the maximum allowed daily loss (0 = unlimited)</p>
                      </div>
                    )}
                  </div>

                  <div className="flex gap-3 mt-6">
                    <button
                      onClick={editingAccount ? updateAccount : addAccount}
                      className="flex-1 bg-cyan-500 text-white py-3 rounded-xl font-semibold hover:bg-cyan-600"
                    >
                      {editingAccount ? '×¢×“×›×Ÿ' : '×¦×•×¨'}
                    </button>
                    <button
                      onClick={() => { setShowAccountModal(false); setEditingAccount(null); }}
                      className="flex-1 bg-gray-700 text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-600"
                    >
                      ×‘×™×˜×•×œ
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Trade Modal */}
            {showTradeModal && (
              <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 overflow-y-auto" onClick={() => { setShowTradeModal(false); setEditingTrade(null); }}>
                <div className="bg-gray-900 rounded-2xl p-6 border border-cyan-500/30 max-w-2xl w-full my-8" onClick={e => e.stopPropagation()}>
                  <h2 className="text-2xl font-bold text-cyan-400 mb-4">{editingTrade ? '×¢×¨×™×›×ª ×¢×¡×§×”' : '×¢×¡×§×” ×—×“×©×”'}</h2>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×ª××¨×™×š</label>
                      <input type="date" value={editingTrade ? editingTrade.date : newTrade.date}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, date: e.target.value }) : setNewTrade({ ...newTrade, date: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×¡×™××‘×•×œ</label>
                      <select value={editingTrade ? editingTrade.symbol : newTrade.symbol}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, symbol: e.target.value }) : setNewTrade({ ...newTrade, symbol: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      >
                        <option value="NQ">NQ</option>
                        <option value="ES">ES</option>
                        <option value="MNQ">MNQ</option>
                        <option value="MES">MES</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×›×™×•×•×Ÿ</label>
                      <select value={editingTrade ? editingTrade.direction : newTrade.direction}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, direction: e.target.value }) : setNewTrade({ ...newTrade, direction: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      >
                        <option value="LONG">LONG</option>
                        <option value="SHORT">SHORT</option>
                      </select>
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×—×•×–×™×</label>
                      <input type="number" value={editingTrade ? editingTrade.contracts : newTrade.contracts}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, contracts: parseInt(e.target.value) }) : setNewTrade({ ...newTrade, contracts: parseInt(e.target.value) })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">××—×™×¨ ×›× ×™×¡×”</label>
                      <input type="number" step="0.01" value={editingTrade ? editingTrade.entryPrice : newTrade.entryPrice}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, entryPrice: parseFloat(e.target.value) }) : setNewTrade({ ...newTrade, entryPrice: parseFloat(e.target.value) })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">××—×™×¨ ×™×¦×™××”</label>
                      <input type="number" step="0.01" value={editingTrade ? editingTrade.exitPrice : newTrade.exitPrice}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, exitPrice: parseFloat(e.target.value) }) : setNewTrade({ ...newTrade, exitPrice: parseFloat(e.target.value) })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm text-gray-300 mb-2">×ª××•× ×ª ×”×¢×¡×§×” (××•×¤×¦×™×•× ×œ×™)</label>
                      <input 
                        type="file" 
                        accept="image/*"
                        onChange={(e) => handleImageUpload(e, !!editingTrade)}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-cyan-500 file:text-white file:cursor-pointer hover:file:bg-cyan-600"
                      />
                      <p className="text-xs text-gray-500 mt-1">××§×¡×™××•× 5MB</p>
                      {(editingTrade?.imageUrl || newTrade.imageUrl) && (
                        <div className="mt-3 relative">
                          <img 
                            src={editingTrade ? editingTrade.imageUrl : newTrade.imageUrl} 
                            alt="×ª××•× ×ª ×¢×¡×§×”" 
                            className="w-full h-48 object-cover rounded-lg border border-cyan-500/30"
                          />
                          <button
                            type="button"
                            onClick={() => editingTrade ? setEditingTrade({ ...editingTrade, imageUrl: '' }) : setNewTrade({ ...newTrade, imageUrl: '' })}
                            className="absolute top-2 left-2 bg-red-500 text-white p-2 rounded-lg hover:bg-red-600"
                          >
                            <TrashIcon size={16} />
                          </button>
                        </div>
                      )}
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm text-gray-300 mb-2">××¡×˜×¨×˜×’×™×”</label>
                      <input type="text" value={editingTrade ? editingTrade.strategy : newTrade.strategy}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, strategy: e.target.value }) : setNewTrade({ ...newTrade, strategy: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div className="col-span-2">
                      <label className="block text-sm text-gray-300 mb-2">×”×¢×¨×•×ª</label>
                      <textarea value={editingTrade ? editingTrade.notes : newTrade.notes}
                        onChange={(e) => editingTrade ? setEditingTrade({ ...editingTrade, notes: e.target.value }) : setNewTrade({ ...newTrade, notes: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-cyan-500/30 rounded-lg text-gray-200" rows="2"
                      />
                    </div>
                  </div>

                  <div className="flex gap-3 mt-6">
                    <button onClick={editingTrade ? updateTrade : addTrade} className="flex-1 bg-cyan-500 text-white py-3 rounded-xl font-semibold hover:bg-cyan-600">
                      {editingTrade ? '×¢×“×›×Ÿ' : '×”×•×¡×£'}
                    </button>
                    <button onClick={() => { setShowTradeModal(false); setEditingTrade(null); }} className="flex-1 bg-gray-700 text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-600">
                      ×‘×™×˜×•×œ
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Payout Modal */}
            {showPayoutModal && selectedAccount && (
              <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => setShowPayoutModal(false)}>
                <div className="bg-gray-900 rounded-2xl p-6 border border-emerald-500/30 max-w-md w-full" onClick={e => e.stopPropagation()}>
                  <h2 className="text-2xl font-bold text-emerald-400 mb-4">××©×™×›×” (Payout)</h2>
                  
                  <div className="mb-4 p-4 bg-cyan-500/10 rounded-xl border border-cyan-500/30">
                    <p className="text-sm text-gray-400">×ª×™×§: {selectedAccount.name}</p>
                    <p className="text-2xl font-bold text-gray-100 mt-1">
                      ×™×ª×¨×”: ${selectedAccount.currentBalance.toLocaleString()}
                    </p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×¡×›×•× ($)</label>
                      <input type="number" value={payoutData.amount}
                        onChange={(e) => setPayoutData({ ...payoutData, amount: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-emerald-500/30 rounded-lg text-gray-200"
                        max={selectedAccount.currentBalance}
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×ª××¨×™×š</label>
                      <input type="date" value={payoutData.date}
                        onChange={(e) => setPayoutData({ ...payoutData, date: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-emerald-500/30 rounded-lg text-gray-200"
                      />
                    </div>

                    <div>
                      <label className="block text-sm text-gray-300 mb-2">×”×¢×¨×•×ª</label>
                      <textarea value={payoutData.notes}
                        onChange={(e) => setPayoutData({ ...payoutData, notes: e.target.value })}
                        className="w-full px-4 py-3 bg-gray-800 border border-emerald-500/30 rounded-lg text-gray-200" rows="2"
                      />
                    </div>
                  </div>

                  {selectedAccount.payouts && selectedAccount.payouts.length > 0 && (
                    <div className="mt-6 border-t border-gray-700 pt-4">
                      <h3 className="text-lg font-bold text-cyan-400 mb-3">×”×™×¡×˜×•×¨×™×™×ª ××©×™×›×•×ª</h3>
                      <div className="space-y-2 max-h-48 overflow-y-auto" style={{ scrollbarWidth: 'thin', scrollbarColor: '#10b981 #1f2937' }}>
                        {[...selectedAccount.payouts].reverse().map((payout, idx) => (
                          <div key={idx} className="bg-gray-800/50 rounded-lg p-3 border border-emerald-500/20">
                            <div className="flex justify-between items-start">
                              <div>
                                <p className="font-bold text-emerald-400">${payout.amount}</p>
                                <p className="text-xs text-gray-400 mt-1">{payout.date}</p>
                                {payout.notes && (
                                  <p className="text-xs text-gray-500 mt-1">{payout.notes}</p>
                                )}
                              </div>
                              <span className="text-xs bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded">
                                #{selectedAccount.payouts.length - idx}
                              </span>
                            </div>
                          </div>
                        ))}
                      </div>
                      <div className="mt-3 p-2 bg-cyan-500/10 rounded-lg border border-cyan-500/30">
                        <p className="text-sm text-gray-300">
                          ×¡×”"×› ××©×™×›×•×ª: <span className="font-bold text-emerald-400">${selectedAccount.payouts.reduce((s, p) => s + p.amount, 0).toFixed(0)}</span>
                        </p>
                      </div>
                    </div>
                  )}

                  <div className="flex gap-3 mt-6">
                    <button onClick={processPayout} className="flex-1 bg-emerald-500 text-white py-3 rounded-xl font-semibold hover:bg-emerald-600">
                      ××©×¨ ××©×™×›×”
                    </button>
                    <button onClick={() => { setShowPayoutModal(false); setPayoutData({ amount: 0, date: new Date().toISOString().split('T')[0], notes: '' }); }} className="flex-1 bg-gray-700 text-gray-300 py-3 rounded-xl font-semibold hover:bg-gray-600">
                      ×‘×™×˜×•×œ
                    </button>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    try {
      console.log('ğŸ¨ Rendering to DOM...');
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
      console.log('âœ… Render complete!');
      
      // Loading screen will be removed by App component when ready
    } catch (err) {
      console.error('âŒ Render error:', err);
      document.getElementById('root').innerHTML = `
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #1a1a2e; color: white;">
          <div style="text-align: center; padding: 20px;">
            <h1 style="color: #f44; font-size: 32px; margin-bottom: 16px;">×©×’×™××” ×‘×˜×¢×™× ×”</h1>
            <p style="color: #888; margin-bottom: 8px;">${err.message}</p>
            <p style="color: #666; font-size: 14px;">×¤×ª×— Console (F12) ×œ×¤×¨×˜×™× × ×•×¡×¤×™×</p>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
